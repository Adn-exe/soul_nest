{% extends "base.html" %}
{% block title %}Soul Nest - New Thought{% endblock %}

{% block content %}
<div class="form-box" data-aos="fade-up" style="
    background: rgba(255, 255, 255, 0.85);
    backdrop-filter: blur(6px);
    padding: 2rem 3rem;
    border-radius: 15px;
    box-shadow: 0 12px 25px rgba(0,0,0,0.2);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    max-width: 600px;
    margin: 3rem auto;
">
    <h2 style="
        font-family: 'Playfair Display', serif;
        font-size: 2rem;
        font-weight: 600;
        text-align: center;
        background: linear-gradient(90deg, #7b6cf6, #c9a3ff);
        -webkit-background-clip: text;
        background-clip: text;
        color: transparent;
        margin-bottom: 1.5rem;
    ">Share a New Thought</h2>

    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="alert alert-{{ category }}" style="transition: all 0.3s ease;">
                    {{ message }}
                </div>
            {% endfor %}
        {% endif %}
    {% endwith %}

    <form method="POST">
        <div class="form-group" style="margin-bottom: 1.5rem; position: relative;">
            <textarea id="content" name="content" class="form-control" rows="5" required placeholder="Share your thoughts..." style="
                width: 100%;
                padding: 0.75rem;
                border: 1px solid #ced4da;
                border-radius: 12px;
                font-size: 1rem;
                font-family: 'PT Serif', serif;
                transition: border-color 0.3s ease, box-shadow 0.3s ease, transform 0.2s ease;
            "></textarea>
        </div>

        <!-- Mood Selector -->
        <div class="form-group" style="margin-bottom: 1.5rem; text-align:center;">
            <label style="
                display: block;
                font-weight: 600;
                font-family: 'Playfair Display', serif;
                font-size: 1.1rem;
                background: linear-gradient(90deg, #7b6cf6, #c9a3ff);
                -webkit-background-clip: text;
                color: transparent;
                margin-bottom: 0.5rem;
            ">Select Your Mood</label>

            <!-- Button that opens the modal -->
            <button type="button" id="openMoodSelector" style="
                padding: 0.6rem 1rem;
                border-radius: 12px;
                border: 1px solid #ced4da;
                background: #f8f8f8;
                font-family: 'PT Serif', serif;
                font-size: 1rem;
                color: #777;
                cursor: pointer;
                transition: all 0.3s ease;
            ">âž¤ Choose Mood</button>

            <input type="hidden" id="mood" name="mood" required>
        </div>

        <button type="submit" class="btn btn-primary mt-3" style="
            width: 100%;
            padding: 0.75rem;
            background: linear-gradient(90deg, #7b6cf6, #c9a3ff);
            border: none;
            border-radius: 12px;
            color: white;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4,0,0.2,1);
        " onmouseover="this.style.transform='scale(1.03)';" onmouseout="this.style.transform='scale(1)';">
            Share Thought
        </button>
    </form>
</div>

<!-- Mood Modal -->
<div id="moodModal" style="
    display:none; 
    position: fixed; 
    top:50%; 
    left:50%; 
    transform: translate(-50%, -50%) scale(0.9); 
    opacity:0; 
    transition: all 0.35s ease; 
    background: white; 
    border-radius: 1rem; 
    padding: 2rem 2.5rem; 
    box-shadow: 0 12px 28px rgba(0,0,0,0.3); 
    z-index:1000;
">
    <h3 style="
        font-family: 'Playfair Display', serif; 
        font-size: 1.5rem; 
        margin-bottom: 1rem; 
        background: linear-gradient(90deg, #7b6cf6, #c9a3ff); 
        -webkit-background-clip: text; 
        color: transparent;
        text-align:center;
    ">Select Your Mood</h3>

    <div class="mood-grid" style="
        display:grid; 
        grid-template-columns:repeat(2,1fr); 
        gap:1rem 1.2rem; 
        justify-items:center; 
        margin-top:1rem;
    ">
        <label class="mood-option"><input type="radio" name="moodOption" value="calm"><span>Calm</span></label>
        <label class="mood-option"><input type="radio" name="moodOption" value="happy"><span>Happy</span></label>
        <label class="mood-option"><input type="radio" name="moodOption" value="thoughtful"><span>Thoughtful</span></label>
        <label class="mood-option"><input type="radio" name="moodOption" value="inspired"><span>Inspired</span></label>
        <label class="mood-option"><input type="radio" name="moodOption" value="excited"><span>Excited</span></label>
        <label class="mood-option"><input type="radio" name="moodOption" value="sad"><span>Sad</span></label>
    </div>
</div>

<!-- Styles -->
<style>
/* Form box hover */
.form-box:hover {
    transform: translateY(-4px) scale(1.01);
    box-shadow: 0 16px 30px rgba(0,0,0,0.25);
}

/* Mood Buttons */
.mood-option {
    position: relative;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    border-radius: 12px;
    background: rgba(255,255,255,0.7);
    box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    padding: 1rem 1.5rem;
    width: 120px;
    transition: all 0.3s ease;
    font-family: 'PT Serif', serif;
}
.mood-option:hover { transform: scale(1.05); box-shadow: 0 6px 14px rgba(123,108,246,0.3); }
.mood-option input { display:none; }
.mood-option span { font-size:1rem; color:#555; transition: all 0.3s ease; text-align:center; }
.mood-option input:checked + span {
    background: linear-gradient(90deg, #7b6cf6, #c9a3ff);
    -webkit-background-clip: text;
    color: transparent;
    font-weight: 600;
    text-shadow: 0 0 6px rgba(123,108,246,0.5);
}
.close-btn:hover { transform: scale(1.05); }
</style>

<!-- Script -->
<script>
const moodModal = document.getElementById('moodModal');
const openBtn = document.getElementById('openMoodSelector');

openBtn.addEventListener('click', () => {
    moodModal.style.display = 'block';
    requestAnimationFrame(() => {
        moodModal.style.opacity = '1';
        moodModal.style.transform = 'translate(-50%, -50%) scale(1)';
    });
});

// New: click on mood option
document.querySelectorAll('.mood-option input').forEach(input => {
    input.addEventListener('change', () => {
        const selected = input.value;
        document.getElementById('mood').value = selected;
        const name = selected.charAt(0).toUpperCase() + selected.slice(1);
        openBtn.textContent = "Mood: " + name;
        openBtn.style.background = "linear-gradient(90deg, #7b6cf6, #c9a3ff)";
        openBtn.style.color = "white";

        // Close modal
        moodModal.style.opacity = '0';
        moodModal.style.transform = 'translate(-50%, -50%) scale(0.9)';
        setTimeout(()=>{ moodModal.style.display='none'; }, 350);
    });
});

// Close modal if clicked outside the card
moodModal.addEventListener('click', (e) => {
    if (e.target === moodModal) { // clicked directly on overlay
        moodModal.style.opacity = '0';
        moodModal.style.transform = 'translate(-50%, -50%) scale(0.9)';
        setTimeout(()=>{ moodModal.style.display='none'; }, 350);
    }
});

</script>
{% endblock %}
